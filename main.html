<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link href="main.css" rel="stylesheet">
    <script src = "main.js"></script>
    <title>mainwindow</title>
</head>
<body>
    <div class = "mainframe" >
        <div id = "scoreboard">
            <p>SCORE</p>
            <div id ="score"><p>0</p></div>
        </div>
        <script>
            //ブロックの配置(html書き換えによってscript直前に挿入)
            let element = document.currentScript;
            for(let i =0;i<4;i++){
                for(let j =0;j<4;j++){
                    element.insertAdjacentHTML('beforebegin', 
                    '<div class = "emptyblock" style ="left:calc(var(--blockspace) + (var(--blockspace) + var(--blocksize))*'+i+');top:calc(var(--blockspace) + (var(--blockspace) + var(--blocksize))*'+j+');"></div>'
                    );
                }
            }
            let controler = new Main(element); 
            let isMoving=false;//ブロックを動かしているか否か
            //キーの押下を検知
            document.addEventListener('keydown', (event) => {
            var keyName = event.key;
            //キーの種別に動作
            //動作中に重ねて動作を起こさないようにする
            if(isMoving!=true){
                isMoving=true;
                switch(keyName){
                    case "ArrowUp":
                    controler.move_block("UP");
                    break;
                    case "ArrowRight":
                    controler.move_block("R");
                    break;
                    case "ArrowLeft":
                    controler.move_block("L");
                    break;
                    case "ArrowDown":
                    controler.move_block("DOWN");
                    break;
                }
                setTimeout(()=>{
                    isMoving=false;
                },200);
            }
        });
        </script>
    </div>
    <div class = "gamemessage" id ="gamemessage_off">
        <p>GAME OVER</p>
    </div>
    <button class = "button" id = "retrybutton_off" onclick="controler.restart();">
        RETRY
    </button>
    <button class = "button" id = "newgamebutton" onclick="controler.restart();">
        NEW GAME
    </button>
    <button onclick="controler.debug()">
        debug
    </button>
</body>
</html>